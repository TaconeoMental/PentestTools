#!/usr/bin/bash
# Crea un archivo con todas los hosts de una subred con el puerto 22 abierto.

help_msg()
{
   echo ""
   echo "Usage: $0 -s [SUBNET MASK] -o [OUT FILE]"
   exit 1
}

while getopts "s:o:" opt
do
   case "$opt" in
      s ) subnet_mask="$OPTARG" ;;
      o ) output_file="$OPTARG" ;;
   esac
done

if [ -z "$subnet_mask" ] || [ -z "$output_file" ]
then
   help_msg
fi

nmap -p 22 --open -sV "$subnet_mask" | grep -Eo '[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}' | awk '{print $NF}' > "$output_file"
var=$(wc -l hosts | awk '{print $1}')
echo "${var} hosts found"
